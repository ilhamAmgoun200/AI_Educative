{"ast":null,"code":"import httpClient from \"./httpClient\";\nimport axios from \"axios\";\nimport { CONFIG } from \"../config\";\nexport const login = async (email, password) => {\n  const res = await httpClient.post(\"/auth/local\", {\n    identifier: email,\n    password: password\n  });\n  return res.data;\n};\nexport const getMe = async () => {\n  const res = await httpClient.get(\"/users/me\");\n  return res.data;\n};\nexport const register = async (username, email, password, roleName) => {\n  const registerRes = await httpClient.post(\"/auth/local/register\", {\n    username,\n    email,\n    password\n  });\n  const {\n    data: rolesRes\n  } = await httpClient.get(\"/users-permissions/roles\");\n  const selectedRole = rolesRes.roles.find(r => r.name.toLowerCase() === roleName.toLowerCase());\n  if (!selectedRole) {\n    throw new Error(`Rôle \"${roleName}\" introuvable dans Strapi`);\n  }\n  const token = registerRes.data.jwt;\n  const userId = registerRes.data.user.id;\n  try {\n    // Utiliser axios directement avec le token pour mettre à jour le rôle\n    await axios.put(`${CONFIG.API_URL}/users/${userId}`, {\n      role: selectedRole.id\n    }, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n        \"Content-Type\": \"application/json\"\n      }\n    });\n\n    // Récupérer les données utilisateur mises à jour avec le rôle\n    const {\n      data: updatedUser\n    } = await axios.get(`${CONFIG.API_URL}/users/${userId}?populate=role`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    });\n\n    // Retourner les données avec le rôle mis à jour\n    return {\n      jwt: token,\n      user: updatedUser\n    };\n  } catch (updateError) {\n    // Si la mise à jour du rôle échoue, retourner quand même les données de base\n    console.warn(\"Impossible de mettre à jour le rôle, l'utilisateur a été créé avec le rôle par défaut:\", updateError);\n\n    // Retourner les données de base même si la mise à jour du rôle échoue\n    return registerRes.data;\n  }\n};","map":{"version":3,"names":["httpClient","axios","CONFIG","login","email","password","res","post","identifier","data","getMe","get","register","username","roleName","registerRes","rolesRes","selectedRole","roles","find","r","name","toLowerCase","Error","token","jwt","userId","user","id","put","API_URL","role","headers","Authorization","updatedUser","updateError","console","warn"],"sources":["C:/gi4/Prijects/AI_Educative/ai-learning-frontend/src/api/auth.js"],"sourcesContent":["import httpClient from \"./httpClient\";\r\nimport axios from \"axios\";\r\nimport { CONFIG } from \"../config\";\r\n\r\nexport const login = async(email, password) =>{\r\n    const res = await httpClient.post(\"/auth/local\",{identifier:email, password: password});\r\n    return res.data ;\r\n};\r\n\r\n\r\nexport const getMe = async () =>{\r\n    const res = await httpClient.get(\"/users/me\");\r\n    return res.data ;\r\n};\r\n\r\nexport const register = async (username, email, password, roleName) => {\r\n \r\n  const registerRes = await httpClient.post(\"/auth/local/register\", {\r\n    username,\r\n    email,\r\n    password,\r\n  });\r\n\r\n\r\n  const { data: rolesRes } = await httpClient.get(\"/users-permissions/roles\");\r\n\r\n\r\n  const selectedRole = rolesRes.roles.find(\r\n    (r) => r.name.toLowerCase() === roleName.toLowerCase()\r\n  );\r\n\r\n  if (!selectedRole) {\r\n    throw new Error(`Rôle \"${roleName}\" introuvable dans Strapi`);\r\n  }\r\n\r\n \r\n  const token = registerRes.data.jwt;\r\n  const userId = registerRes.data.user.id;\r\n\r\n  try {\r\n    // Utiliser axios directement avec le token pour mettre à jour le rôle\r\n    await axios.put(\r\n      `${CONFIG.API_URL}/users/${userId}`,\r\n      {\r\n        role: selectedRole.id,\r\n      },\r\n      {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      }\r\n    );\r\n\r\n    // Récupérer les données utilisateur mises à jour avec le rôle\r\n    const { data: updatedUser } = await axios.get(\r\n      `${CONFIG.API_URL}/users/${userId}?populate=role`,\r\n      {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      }\r\n    );\r\n\r\n    // Retourner les données avec le rôle mis à jour\r\n    return {\r\n      jwt: token,\r\n      user: updatedUser,\r\n    };\r\n  } catch (updateError) {\r\n    // Si la mise à jour du rôle échoue, retourner quand même les données de base\r\n    console.warn(\"Impossible de mettre à jour le rôle, l'utilisateur a été créé avec le rôle par défaut:\", updateError);\r\n    \r\n    // Retourner les données de base même si la mise à jour du rôle échoue\r\n    return registerRes.data;\r\n  }\r\n};"],"mappings":"AAAA,OAAOA,UAAU,MAAM,cAAc;AACrC,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,MAAM,QAAQ,WAAW;AAElC,OAAO,MAAMC,KAAK,GAAG,MAAAA,CAAMC,KAAK,EAAEC,QAAQ,KAAI;EAC1C,MAAMC,GAAG,GAAG,MAAMN,UAAU,CAACO,IAAI,CAAC,aAAa,EAAC;IAACC,UAAU,EAACJ,KAAK;IAAEC,QAAQ,EAAEA;EAAQ,CAAC,CAAC;EACvF,OAAOC,GAAG,CAACG,IAAI;AACnB,CAAC;AAGD,OAAO,MAAMC,KAAK,GAAG,MAAAA,CAAA,KAAW;EAC5B,MAAMJ,GAAG,GAAG,MAAMN,UAAU,CAACW,GAAG,CAAC,WAAW,CAAC;EAC7C,OAAOL,GAAG,CAACG,IAAI;AACnB,CAAC;AAED,OAAO,MAAMG,QAAQ,GAAG,MAAAA,CAAOC,QAAQ,EAAET,KAAK,EAAEC,QAAQ,EAAES,QAAQ,KAAK;EAErE,MAAMC,WAAW,GAAG,MAAMf,UAAU,CAACO,IAAI,CAAC,sBAAsB,EAAE;IAChEM,QAAQ;IACRT,KAAK;IACLC;EACF,CAAC,CAAC;EAGF,MAAM;IAAEI,IAAI,EAAEO;EAAS,CAAC,GAAG,MAAMhB,UAAU,CAACW,GAAG,CAAC,0BAA0B,CAAC;EAG3E,MAAMM,YAAY,GAAGD,QAAQ,CAACE,KAAK,CAACC,IAAI,CACrCC,CAAC,IAAKA,CAAC,CAACC,IAAI,CAACC,WAAW,CAAC,CAAC,KAAKR,QAAQ,CAACQ,WAAW,CAAC,CACvD,CAAC;EAED,IAAI,CAACL,YAAY,EAAE;IACjB,MAAM,IAAIM,KAAK,CAAC,SAAST,QAAQ,2BAA2B,CAAC;EAC/D;EAGA,MAAMU,KAAK,GAAGT,WAAW,CAACN,IAAI,CAACgB,GAAG;EAClC,MAAMC,MAAM,GAAGX,WAAW,CAACN,IAAI,CAACkB,IAAI,CAACC,EAAE;EAEvC,IAAI;IACF;IACA,MAAM3B,KAAK,CAAC4B,GAAG,CACb,GAAG3B,MAAM,CAAC4B,OAAO,UAAUJ,MAAM,EAAE,EACnC;MACEK,IAAI,EAAEd,YAAY,CAACW;IACrB,CAAC,EACD;MACEI,OAAO,EAAE;QACPC,aAAa,EAAE,UAAUT,KAAK,EAAE;QAChC,cAAc,EAAE;MAClB;IACF,CACF,CAAC;;IAED;IACA,MAAM;MAAEf,IAAI,EAAEyB;IAAY,CAAC,GAAG,MAAMjC,KAAK,CAACU,GAAG,CAC3C,GAAGT,MAAM,CAAC4B,OAAO,UAAUJ,MAAM,gBAAgB,EACjD;MACEM,OAAO,EAAE;QACPC,aAAa,EAAE,UAAUT,KAAK;MAChC;IACF,CACF,CAAC;;IAED;IACA,OAAO;MACLC,GAAG,EAAED,KAAK;MACVG,IAAI,EAAEO;IACR,CAAC;EACH,CAAC,CAAC,OAAOC,WAAW,EAAE;IACpB;IACAC,OAAO,CAACC,IAAI,CAAC,wFAAwF,EAAEF,WAAW,CAAC;;IAEnH;IACA,OAAOpB,WAAW,CAACN,IAAI;EACzB;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}