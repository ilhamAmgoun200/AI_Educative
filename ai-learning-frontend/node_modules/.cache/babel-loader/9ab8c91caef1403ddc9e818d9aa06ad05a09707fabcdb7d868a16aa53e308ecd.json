{"ast":null,"code":"import httpClient from \"./httpClient\";\nimport { CONFIG } from \"../config\";\nimport { setAuthData, saveToken, saveUser } from \"../utils/localStorage\";\n\n/**\r\n * üîê Connexion utilisateur\r\n * @param {string} email\r\n * @param {string} password\r\n * @returns {Promise<{jwt: string, user: object}>}\r\n */\nexport const login = async (email, password) => {\n  try {\n    const {\n      data\n    } = await httpClient.post(\"/auth/local\", {\n      identifier: email,\n      password\n    });\n    setAuthData(data.jwt, data.user);\n    return data;\n  } catch (error) {\n    var _error$response;\n    console.error(\"‚ùå Erreur lors de la connexion :\", ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data) || error.message);\n    throw error;\n  }\n};\n\n/**\r\n * üë§ R√©cup√©rer les informations de l'utilisateur connect√©\r\n * @returns {Promise<object>}\r\n */\nexport const getMe = async () => {\n  try {\n    const {\n      data\n    } = await httpClient.get(\"/users/me?populate=role\");\n    saveUser(data);\n    return data;\n  } catch (error) {\n    var _error$response2;\n    console.error(\"‚ùå Erreur lors de la r√©cup√©ration du profil :\", ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data) || error.message);\n    throw error;\n  }\n};\nexport const register = async (username, email, password, roleName) => {\n  try {\n    const {\n      data: registerRes\n    } = await httpClient.post(\"/auth/local/register\", {\n      username,\n      email,\n      password\n    });\n    const token = registerRes.jwt;\n    const userId = registerRes.user.id;\n\n    // √âtape 2Ô∏è‚É£ : R√©cup√©ration des r√¥les disponibles\n    const {\n      data: rolesRes\n    } = await httpClient.get(\"/users-permissions/roles\");\n    const selectedRole = rolesRes.roles.find(r => r.name.toLowerCase() === roleName.toLowerCase());\n    if (!selectedRole) {\n      throw new Error(`R√¥le \"${roleName}\" introuvable dans Strapi`);\n    }\n\n    // √âtape 3Ô∏è‚É£ : Mise √† jour du r√¥le utilisateur (n√©cessite token explicite)\n    await httpClient.put(`/users/${userId}`, {\n      role: selectedRole.id\n    }, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    });\n\n    // √âtape 4Ô∏è‚É£ : R√©cup√©ration de l'utilisateur mis √† jour avec son r√¥le\n    const {\n      data: updatedUser\n    } = await httpClient.get(`/users/${userId}?populate=role`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    });\n\n    // √âtape 5Ô∏è‚É£ : Sauvegarde dans le localStorage\n    setAuthData(token, updatedUser);\n    return {\n      jwt: token,\n      user: updatedUser\n    };\n  } catch (error) {\n    var _error$response3;\n    console.warn(\"‚ö†Ô∏è √âchec de l‚Äôinscription ou de la mise √† jour du r√¥le :\", ((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.data) || error.message);\n    throw error;\n  }\n};","map":{"version":3,"names":["httpClient","CONFIG","setAuthData","saveToken","saveUser","login","email","password","data","post","identifier","jwt","user","error","_error$response","console","response","message","getMe","get","_error$response2","register","username","roleName","registerRes","token","userId","id","rolesRes","selectedRole","roles","find","r","name","toLowerCase","Error","put","role","headers","Authorization","updatedUser","_error$response3","warn"],"sources":["C:/gi4/Prijects/AI_Educative/ai-learning-frontend/src/api/auth.js"],"sourcesContent":["import httpClient from \"./httpClient\";\r\nimport { CONFIG } from \"../config\";\r\nimport { setAuthData, saveToken, saveUser } from \"../utils/localStorage\";\r\n\r\n/**\r\n * üîê Connexion utilisateur\r\n * @param {string} email\r\n * @param {string} password\r\n * @returns {Promise<{jwt: string, user: object}>}\r\n */\r\nexport const login = async (email, password) => {\r\n  try {\r\n    const { data } = await httpClient.post(\"/auth/local\", {\r\n      identifier: email,\r\n      password,\r\n    });\r\n    setAuthData(data.jwt, data.user);\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"‚ùå Erreur lors de la connexion :\", error.response?.data || error.message);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * üë§ R√©cup√©rer les informations de l'utilisateur connect√©\r\n * @returns {Promise<object>}\r\n */\r\nexport const getMe = async () => {\r\n  try {\r\n    const { data } = await httpClient.get(\"/users/me?populate=role\");\r\n    saveUser(data);\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"‚ùå Erreur lors de la r√©cup√©ration du profil :\", error.response?.data || error.message);\r\n    throw error;\r\n  }\r\n};\r\n\r\n\r\nexport const register = async (username, email, password, roleName) => {\r\n  try {\r\n    \r\n    const { data: registerRes } = await httpClient.post(\"/auth/local/register\", {\r\n      username,\r\n      email,\r\n      password,\r\n    });\r\n\r\n    const token = registerRes.jwt;\r\n    const userId = registerRes.user.id;\r\n\r\n    // √âtape 2Ô∏è‚É£ : R√©cup√©ration des r√¥les disponibles\r\n    const { data: rolesRes } = await httpClient.get(\"/users-permissions/roles\");\r\n\r\n    const selectedRole = rolesRes.roles.find(\r\n      (r) => r.name.toLowerCase() === roleName.toLowerCase()\r\n    );\r\n\r\n    if (!selectedRole) {\r\n      throw new Error(`R√¥le \"${roleName}\" introuvable dans Strapi`);\r\n    }\r\n\r\n    // √âtape 3Ô∏è‚É£ : Mise √† jour du r√¥le utilisateur (n√©cessite token explicite)\r\n    await httpClient.put(\r\n      `/users/${userId}`,\r\n      { role: selectedRole.id },\r\n      {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      }\r\n    );\r\n\r\n    // √âtape 4Ô∏è‚É£ : R√©cup√©ration de l'utilisateur mis √† jour avec son r√¥le\r\n    const { data: updatedUser } = await httpClient.get(\r\n      `/users/${userId}?populate=role`,\r\n      {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      }\r\n    );\r\n\r\n    // √âtape 5Ô∏è‚É£ : Sauvegarde dans le localStorage\r\n    setAuthData(token, updatedUser);\r\n\r\n    return {\r\n      jwt: token,\r\n      user: updatedUser,\r\n    };\r\n  } catch (error) {\r\n    console.warn(\"‚ö†Ô∏è √âchec de l‚Äôinscription ou de la mise √† jour du r√¥le :\", error.response?.data || error.message);\r\n    throw error;\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}