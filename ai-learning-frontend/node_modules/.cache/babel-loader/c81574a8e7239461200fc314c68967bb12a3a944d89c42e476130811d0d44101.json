{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Admin\\\\AI_Educative\\\\ai-learning-frontend\\\\src\\\\contexts\\\\authContext.js\",\n  _s = $RefreshSig$();\nimport { createContext, useState, useEffect } from \"react\";\nimport { getMe } from \"../api/auth\";\nimport { saveToken, getToken, saveUser, getUser, clearAuthData } from \"../utils/localStorage\";\nimport { useNavigate } from \"react-router-dom\";\n\n// Gérer les sessions utilisateur\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext();\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [user, setUser] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const navigate = useNavigate();\n\n  // Vérifier si un token existe au chargement de l'application\n  useEffect(() => {\n    const checkAuth = async () => {\n      const token = getToken();\n      const savedUser = getUser();\n      if (token) {\n        try {\n          // Tenter de récupérer les données utilisateur depuis le serveur\n          const userData = await getMe();\n          setUser(userData);\n        } catch (error) {\n          console.warn(\"Token invalide ou expiré, déconnexion...\");\n          // Si le token est invalide, nettoyer les données\n          clearAuthData();\n          setUser(null);\n        }\n      } else if (savedUser) {\n        // Si pas de token mais un utilisateur en cache, nettoyer\n        clearAuthData();\n      }\n      setIsLoading(false);\n    };\n    checkAuth();\n  }, []);\n\n  /*const loginUser = (data) => {\n    if (!data || !data.jwt || !data.user) {\n      console.error(\"Données d'authentification invalides\");\n      return;\n    }\n     // Sauvegarder le token et les données utilisateur\n    saveToken(data.jwt);\n    saveUser(data.user);\n    setUser(data.user);\n    \n    // Rediriger vers le dashboard\n    navigate(\"/dashboard\");\n  };\n   const logout = () => {\n    clearAuthData();\n    setUser(null);\n    navigate(\"/login\");\n  };*/\n\n  const loginUser = data => {\n    var _data$user$role, _data$user$role2;\n    if (!data || !data.jwt || !data.user) {\n      console.error(\"Données d'authentification invalides\");\n      return;\n    }\n    saveToken(data.jwt);\n    saveUser(data.user);\n    setUser(data.user);\n    const userRole = ((_data$user$role = data.user.role) === null || _data$user$role === void 0 ? void 0 : _data$user$role.type) || ((_data$user$role2 = data.user.role) === null || _data$user$role2 === void 0 ? void 0 : _data$user$role2.name);\n    console.log(\"Role de l'utilisateur:\", userRole); // Debug\n    console.log(\"Donnees utilisateur:\", data.user); // Debug\n\n    if (userRole === 'teacher' || userRole === 'professeur' || userRole === 'prof') {\n      navigate(\"/teacher/dashboard\");\n    } else if (userRole === 'student' || userRole === 'etudiant') {\n      navigate(\"/dashboard\");\n    } else {\n      // Par défaut, rediriger vers dashboard générique\n      navigate(\"/\");\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      loginUser,\n      logout,\n      isLoading\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"o5QfC7aYrUkj9YQ0lGSakMfCddo=\", false, function () {\n  return [useNavigate];\n});\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useState","useEffect","getMe","saveToken","getToken","saveUser","getUser","clearAuthData","useNavigate","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","user","setUser","isLoading","setIsLoading","navigate","checkAuth","token","savedUser","userData","error","console","warn","loginUser","data","_data$user$role","_data$user$role2","jwt","userRole","role","type","name","log","Provider","value","logout","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/Admin/AI_Educative/ai-learning-frontend/src/contexts/authContext.js"],"sourcesContent":["import { createContext, useState, useEffect } from \"react\";\nimport { getMe } from \"../api/auth\";\nimport { saveToken, getToken, saveUser, getUser, clearAuthData } from \"../utils/localStorage\";\nimport { useNavigate } from \"react-router-dom\";\n\n// Gérer les sessions utilisateur\nexport const AuthContext = createContext();\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const navigate = useNavigate();\n\n  // Vérifier si un token existe au chargement de l'application\n  useEffect(() => {\n    const checkAuth = async () => {\n      const token = getToken();\n      const savedUser = getUser();\n\n      if (token) {\n        try {\n          // Tenter de récupérer les données utilisateur depuis le serveur\n          const userData = await getMe();\n          setUser(userData);\n        } catch (error) {\n          console.warn(\"Token invalide ou expiré, déconnexion...\");\n          // Si le token est invalide, nettoyer les données\n          clearAuthData();\n          setUser(null);\n        }\n      } else if (savedUser) {\n        // Si pas de token mais un utilisateur en cache, nettoyer\n        clearAuthData();\n      }\n\n      setIsLoading(false);\n    };\n\n    checkAuth();\n  }, []);\n\n  /*const loginUser = (data) => {\n    if (!data || !data.jwt || !data.user) {\n      console.error(\"Données d'authentification invalides\");\n      return;\n    }\n\n    // Sauvegarder le token et les données utilisateur\n    saveToken(data.jwt);\n    saveUser(data.user);\n    setUser(data.user);\n    \n    // Rediriger vers le dashboard\n    navigate(\"/dashboard\");\n  };\n\n  const logout = () => {\n    clearAuthData();\n    setUser(null);\n    navigate(\"/login\");\n  };*/\n\n\n  const loginUser = (data) => {\n       if (!data || !data.jwt || !data.user) {\n         console.error(\"Données d'authentification invalides\");\n         return;\n       }\n     \n       saveToken(data.jwt);\n       saveUser(data.user);\n       setUser(data.user);\n       \n       const userRole = data.user.role?.type || data.user.role?.name;\n       \n       console.log(\"Role de l'utilisateur:\", userRole); // Debug\n       console.log(\"Donnees utilisateur:\", data.user); // Debug\n       \n       if (userRole === 'teacher' || userRole === 'professeur' || userRole === 'prof') {\n         navigate(\"/teacher/dashboard\");\n       } else if (userRole === 'student' || userRole === 'etudiant') {\n         navigate(\"/dashboard\");\n       } else {\n         // Par défaut, rediriger vers dashboard générique\n         navigate(\"/\");\n       }\n   };\n\n  return (\n    <AuthContext.Provider value={{ user, loginUser, logout, isLoading }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}